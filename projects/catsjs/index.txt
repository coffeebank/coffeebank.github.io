0:["N9fs9zcFq92NLyIxEiws1",[[["",{"children":["(home)",{"children":["projects",{"children":["catsjs",{"children":["__PAGE__",{}]}]}]}]},"$undefined","$undefined",true],"$L1",[[],"$L2"]]]]
3:HL["/_next/static/media/4c472ffaefe8ebfa-s.p.woff2","font",{"crossOrigin":"","type":"font/woff2"}]
4:HL["/_next/static/css/db19166c1fb6b326.css","style",{"crossOrigin":""}]
5:HL["/_next/static/css/6c9015bfdf3d2785.css","style",{"crossOrigin":""}]
6:HL["/_next/static/css/bc1646f45069080b.css","style",{"crossOrigin":""}]
7:I[6954,[],""]
8:I[7264,[],""]
9:I[3619,["9160","static/chunks/app/not-found-5b9cc586c061ef1a.js"],""]
a:I[2738,["8326","static/chunks/8326-f7e9eeb8916f06b2.js","9907","static/chunks/9907-ec9b461539ee1154.js","1820","static/chunks/1820-e4d914bd3f72f9fa.js","4612","static/chunks/4612-46811ea44af4856d.js","8056","static/chunks/app/(coffee-maubot)/layout-d466260fa8a1703d.js"],""]
b:I[9929,["8326","static/chunks/8326-f7e9eeb8916f06b2.js","9907","static/chunks/9907-ec9b461539ee1154.js","1820","static/chunks/1820-e4d914bd3f72f9fa.js","4612","static/chunks/4612-46811ea44af4856d.js","8056","static/chunks/app/(coffee-maubot)/layout-d466260fa8a1703d.js"],""]
c:I[7336,["8326","static/chunks/8326-f7e9eeb8916f06b2.js","9907","static/chunks/9907-ec9b461539ee1154.js","1820","static/chunks/1820-e4d914bd3f72f9fa.js","4612","static/chunks/4612-46811ea44af4856d.js","8056","static/chunks/app/(coffee-maubot)/layout-d466260fa8a1703d.js"],""]
e:I[714,["8326","static/chunks/8326-f7e9eeb8916f06b2.js","1820","static/chunks/1820-e4d914bd3f72f9fa.js","2576","static/chunks/app/(home)/projects/catsjs/page-07cff52f63091e07.js"],""]
f:I[6193,["8326","static/chunks/8326-f7e9eeb8916f06b2.js","1820","static/chunks/1820-e4d914bd3f72f9fa.js","2576","static/chunks/app/(home)/projects/catsjs/page-07cff52f63091e07.js"],""]
10:I[8326,["8326","static/chunks/8326-f7e9eeb8916f06b2.js","1820","static/chunks/1820-e4d914bd3f72f9fa.js","2576","static/chunks/app/(home)/projects/catsjs/page-07cff52f63091e07.js"],""]
2:[["$","meta","0",{"charSet":"utf-8"}],["$","title","1",{"children":"cats.jsâ€„|â€„â˜•ğŸ¦"}],["$","meta","2",{"name":"description","content":"A simple, privacy-friendly, self-hosted analytics solution for websites."}],["$","meta","3",{"name":"theme-color","content":"#293658"}],["$","meta","4",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","meta","5",{"name":"og:image","content":"https://coffeebank.netlify.app/home/media/avinash-kumar-TIGDsyy0TK4-unsplash_c01_twitter.jpg"}],["$","meta","6",{"property":"og:title","content":"cats.js: Website Analytics"}],["$","meta","7",{"property":"og:description","content":"A simple, privacy-friendly, self-hosted analytics solution for websites."}],["$","meta","8",{"property":"og:site_name","content":"Coffeebankâ€‚â˜•"}],["$","meta","9",{"property":"og:image","content":"https://coffeebank.netlify.app/home/media/avinash-kumar-TIGDsyy0TK4-unsplash_c01_twitter.jpg"}],["$","meta","10",{"name":"twitter:card","content":"summary_large_image"}],["$","meta","11",{"name":"twitter:title","content":"cats.js: Website Analytics"}],["$","meta","12",{"name":"twitter:description","content":"A simple, privacy-friendly, self-hosted analytics solution for websites."}],["$","meta","13",{"name":"twitter:image","content":"https://coffeebank.netlify.app/home/media/avinash-kumar-TIGDsyy0TK4-unsplash_c01_twitter.jpg"}],["$","link","14",{"rel":"shortcut icon","href":"/icon.png"}],["$","link","15",{"rel":"icon","href":"/icon.png"}],["$","link","16",{"rel":"apple-touch-icon","href":"/icon.png"}],["$","meta","17",{"name":"next-size-adjust"}]]
11:T891,const { MongoClient } = require("mongodb");

// To enable CORS
const headers = {
  'Access-Control-Allow-Origin': 'ğŸŸ¨ğŸŸ¨ğŸŸ¨ğŸŸ¨ğŸŸ¨',
  'Access-Control-Allow-Credentials': 'true',
  'Access-Control-Allow-Headers': 'Content-Type',
  'Access-Control-Allow-Methods': 'POST, OPTIONS'
};

async function postData(jsonSession, jsonTime, jsonUserAgent, jsonPage) {
  const uri = ğŸŸ¨ğŸŸ¨ğŸŸ¨ğŸŸ¨ğŸŸ¨;
  const client = new MongoClient(uri, {
    useNewUrlParser: true,
    useUnifiedTopology: true,
  });
  try {
    await client.connect();
    const commitData = await client
      .db('ğŸŸ¨ğŸŸ¨ğŸŸ¨ğŸŸ¨ğŸŸ¨')
      .collection('ğŸŸ¨ğŸŸ¨ğŸŸ¨ğŸŸ¨ğŸŸ¨')
      .insertOne({
        session: parseInt(jsonSession),
        time: jsonTime,
        useragent: jsonUserAgent,
        page: jsonPage
      })
    return commitData;
  } catch (err) {
    console.log(err); // output to netlify function log
  } finally {
    await client.close();
  }
}

function errOutput(statusCode, err) {
  return {
    statusCode: statusCode,
    headers: {
      'Access-Control-Allow-Origin': 'ğŸŸ¨ğŸŸ¨ğŸŸ¨ğŸŸ¨ğŸŸ¨',
      'Access-Control-Allow-Headers': 'Content-Type'
    },
    body: JSON.stringify({ error: err })
  }
}

exports.handler = async function(event, context) {
  // Add CORS support
  switch (event.httpMethod) {
    case 'POST':
      if (!event.body || event.httpMethod !== 'POST') {
        return errOutput(500, "No data in json");
      }
      try {
        const data = JSON.parse(event.body);
        if (!data.sessionId || !data.time || !data.useragent || !data.page ) {
          return errOutput(500, "Improper data in json");
        }
        const commitData = await postData(data.sessionId, data.time, data.useragent, data.page);
        console.log(commitData);
        return {
          statusCode: 200,
          headers,
          body: 'Success'
        };
      } catch (error) {
        return {
          statusCode: 500,
          headers,
          body: JSON.stringify({ error: 'Failed' }),
        };
      }
    case 'OPTIONS':
      return {
        statusCode: 200, // <-- Must be 200 otherwise pre-flight call fails
        headers,
        body: '200'
      };
  }
};12:T4f6,if (JSON.parse(localStorage.getItem("analyticsIgnore")) !== "true" && window.location.hostname !== "localhost") {
  let varSession;
  let varTime;
  let dateObj;
  let varUserAgent;
  let varPage;

  try {
    // sessionStorage is cleared/reset when tab closes
    // use iso timestamp as session id
    let varId = sessionStorage.getItem('varId');
    
    if (varId) {
      // ongoing session
      varSession = varId;
      dateObj = new Date();
      varTime = dateObj.toString();
    } else {
      // new session
      dateObj = new Date();
      varSession = Date.parse(dateObj);
      varTime = dateObj.toString();
      sessionStorage.setItem("varId", JSON.stringify(varSession));
    }
    console.log(varSession);

    varUserAgent = navigator.userAgent;
    varPage = window.location.pathname;
  } catch (error) {
    console.log({ error });
  }

  // send to database
  try {
    const options = new Blob(
      [JSON.stringify({
        sessionId: parseInt(varSession),
        time: varTime,
        useragent: varUserAgent,
        page: varPage,
      })],
      {type : 'application/json'}
    );
    navigator.sendBeacon('ğŸŸ¨ğŸŸ¨ğŸŸ¨ğŸŸ¨ğŸŸ¨', options);
  } catch (error) {
    console.log({ error })
  }
} else {
  console.log("analyticsIgnore");
}1:[null,["$","$L7",null,{"parallelRouterKey":"children","segmentPath":["children"],"loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","template":["$","$L8",null,{}],"templateStyles":"$undefined","notFound":["$","$L9",null,{}],"notFoundStyles":[],"childProp":{"current":[null,["$","html",null,{"lang":"en","className":"scroll-smooth","children":["$","body",null,{"className":"scroll-smooth __className_54b096","children":[["$","aside",null,{"className":"hidden sm:block h-screen [&:hover_.cc-sidebar-show]:w-full w-[calc(3.75rem+3px)] sm:w-[4.75rem] hover:w-[264px] lg:w-[264px] fixed overflow-hidden transition-all duration-300 bg-white dark:bg-[#242424] z-50","children":["$","$La",null,{"category":{"me":{"name":"Coffeebank","image":"https://avatars3.githubusercontent.com/u/23473065","home":"/"},"main":[{"to":"/","name":"Home","icon":"HomeIcon"},{"to":"/projects/","name":"Projects","icon":"BriefcaseIcon"},{"to":"/blog/","name":"Blog","icon":"NewspaperIcon"}],"body":[{"to":"/about/","name":"About","icon":"UserCircleIcon"}]}}]}],["$","$Lb",null,{"category":{"me":{"name":"Coffeebank","image":"https://avatars3.githubusercontent.com/u/23473065","home":"/"},"main":[{"to":"/","name":"Home","icon":"HomeIcon"},{"to":"/projects/","name":"Projects","icon":"BriefcaseIcon"},{"to":"/blog/","name":"Blog","icon":"NewspaperIcon"}],"body":[{"to":"/about/","name":"About","icon":"UserCircleIcon"}]}}],["$","main",null,{"className":"h-bottombar-mini-screen xxs:h-bottombar-screen sm:h-screen overflow-y-auto w-full sm:pl-[4.75rem] lg:pl-[264px] transition-all duration-300 bg-black/[0.03] dark:bg-black/[0.97]","aria-label":"Page contents","id":"main","children":["$","$Lc",null,{"children":["$","$L7",null,{"parallelRouterKey":"children","segmentPath":["children","(home)","children"],"loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","template":["$","$L8",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$","$L7",null,{"parallelRouterKey":"children","segmentPath":["children","(home)","children","projects","children"],"loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","template":["$","$L8",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$","$L7",null,{"parallelRouterKey":"children","segmentPath":["children","(home)","children","projects","children","catsjs","children"],"loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","template":["$","$L8",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$Ld",["$","div",null,{"className":"px-5 xs:px-6 sm:px-12 lg:px-16 pt-4 xl:pt-6 pb-20 max-w-[1200px] mx-auto","children":[["$","$Le",null,{"title":"cats.js","subtitle":"Website Analytics","description":"A simple, privacy-friendly, self-hosted analytics solution for websites.","image":"https://coffeebank.netlify.app/home/media/avinash-kumar-TIGDsyy0TK4-unsplash_c01.jpg"}],["$","$Lf",null,{"children":[["$","h1",null,{"children":"The Case Study ğŸˆ"}],"\n",["$","p",null,{"children":"While making websites, I found that I happened to need only three things analytics-wise:"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":[["$","strong",null,{"children":"Time of site visit:"}]," Am I getting a flood of traffic at a certain time?"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"User agent:"}]," What browsers do I need to prioritize? Are there a lot of Mobile Safari users?"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"Pages visited:"}]," What is a normal user journey like? Are they running into 404 pages frequently?"]}],"\n"]}],"\n",["$","p",null,{"children":["The most important was the last one. I needed to know specifically ",["$","strong",null,{"children":"if users were getting stuck"}]," moving from one page to another, not only basic page view counts."]}],"\n",["$","p",null,{"children":["However, many of the market solutions were either not enough, or too much. ",["$","a",null,{"href":"https://microanalytics.io/","target":"_blank","rel":"noopener","className":"inline","children":["Microanalytics.io",["$","span",null,{"className":"inline pl-1 select-none aria-hidden","children":["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","viewBox":"0 0 20 20","fill":"currentColor","aria-hidden":"true","data-slot":"icon","aria-labelledby":"$undefined","className":"inline w-3 h-3","children":[null,["$","path",null,{"fillRule":"evenodd","d":"M4.25 5.5a.75.75 0 0 0-.75.75v8.5c0 .414.336.75.75.75h8.5a.75.75 0 0 0 .75-.75v-4a.75.75 0 0 1 1.5 0v4A2.25 2.25 0 0 1 12.75 17h-8.5A2.25 2.25 0 0 1 2 14.75v-8.5A2.25 2.25 0 0 1 4.25 4h5a.75.75 0 0 1 0 1.5h-5Z","clipRule":"evenodd"}],["$","path",null,{"fillRule":"evenodd","d":"M6.194 12.753a.75.75 0 0 0 1.06.053L16.5 4.44v2.81a.75.75 0 0 0 1.5 0v-4.5a.75.75 0 0 0-.75-.75h-4.5a.75.75 0 0 0 0 1.5h2.553l-9.056 8.194a.75.75 0 0 0-.053 1.06Z","clipRule":"evenodd"}]]}]}]]}]," and ",["$","a",null,{"href":"https://beampipe.io/","target":"_blank","rel":"noopener","className":"inline","children":["Beampipe",["$","span",null,{"className":"inline pl-1 select-none aria-hidden","children":["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","viewBox":"0 0 20 20","fill":"currentColor","aria-hidden":"true","data-slot":"icon","aria-labelledby":"$undefined","className":"inline w-3 h-3","children":[null,["$","path",null,{"fillRule":"evenodd","d":"M4.25 5.5a.75.75 0 0 0-.75.75v8.5c0 .414.336.75.75.75h8.5a.75.75 0 0 0 .75-.75v-4a.75.75 0 0 1 1.5 0v4A2.25 2.25 0 0 1 12.75 17h-8.5A2.25 2.25 0 0 1 2 14.75v-8.5A2.25 2.25 0 0 1 4.25 4h5a.75.75 0 0 1 0 1.5h-5Z","clipRule":"evenodd"}],["$","path",null,{"fillRule":"evenodd","d":"M6.194 12.753a.75.75 0 0 0 1.06.053L16.5 4.44v2.81a.75.75 0 0 0 1.5 0v-4.5a.75.75 0 0 0-.75-.75h-4.5a.75.75 0 0 0 0 1.5h2.553l-9.056 8.194a.75.75 0 0 0-.053 1.06Z","clipRule":"evenodd"}]]}]}]]}]," were nice, but didn't track sessions. ",["$","a",null,{"href":"https://matomo.org/","target":"_blank","rel":"noopener","className":"inline","children":["Matomo",["$","span",null,{"className":"inline pl-1 select-none aria-hidden","children":["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","viewBox":"0 0 20 20","fill":"currentColor","aria-hidden":"true","data-slot":"icon","aria-labelledby":"$undefined","className":"inline w-3 h-3","children":[null,["$","path",null,{"fillRule":"evenodd","d":"M4.25 5.5a.75.75 0 0 0-.75.75v8.5c0 .414.336.75.75.75h8.5a.75.75 0 0 0 .75-.75v-4a.75.75 0 0 1 1.5 0v4A2.25 2.25 0 0 1 12.75 17h-8.5A2.25 2.25 0 0 1 2 14.75v-8.5A2.25 2.25 0 0 1 4.25 4h5a.75.75 0 0 1 0 1.5h-5Z","clipRule":"evenodd"}],["$","path",null,{"fillRule":"evenodd","d":"M6.194 12.753a.75.75 0 0 0 1.06.053L16.5 4.44v2.81a.75.75 0 0 0 1.5 0v-4.5a.75.75 0 0 0-.75-.75h-4.5a.75.75 0 0 0 0 1.5h2.553l-9.056 8.194a.75.75 0 0 0-.053 1.06Z","clipRule":"evenodd"}]]}]}]]}]," was too large, and depended on upkeeping a server."]}],"\n",["$","p",null,{"children":"So I decided to build my own. A simple, privacy-friendly analytics solution that logs user trips across pages. Self-hostable, serverless, and scalable."}],"\n",["$","h1",null,{"children":"Getting Started"}],"\n",[["$","span",null,{"id":"services"}],["$","h3",null,{"children":["$","$L10",null,{"href":"#services","className":"after:content-['#'] after:ml-2 after:invisible hover:after:visible after:font-light after:text-base","children":"Services"}]}]],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"MongoDB (free)"}],"\n",["$","li",null,{"children":"Netlify Functions (free)"}],"\n"]}],"\n",["$","p",null,{"children":["My approach follows the ",["$","a",null,{"href":"https://jamstack.org/","target":"_blank","rel":"noopener","className":"inline","children":["Jamstack philosophy",["$","span",null,{"className":"inline pl-1 select-none aria-hidden","children":["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","viewBox":"0 0 20 20","fill":"currentColor","aria-hidden":"true","data-slot":"icon","aria-labelledby":"$undefined","className":"inline w-3 h-3","children":[null,["$","path",null,{"fillRule":"evenodd","d":"M4.25 5.5a.75.75 0 0 0-.75.75v8.5c0 .414.336.75.75.75h8.5a.75.75 0 0 0 .75-.75v-4a.75.75 0 0 1 1.5 0v4A2.25 2.25 0 0 1 12.75 17h-8.5A2.25 2.25 0 0 1 2 14.75v-8.5A2.25 2.25 0 0 1 4.25 4h5a.75.75 0 0 1 0 1.5h-5Z","clipRule":"evenodd"}],["$","path",null,{"fillRule":"evenodd","d":"M6.194 12.753a.75.75 0 0 0 1.06.053L16.5 4.44v2.81a.75.75 0 0 0 1.5 0v-4.5a.75.75 0 0 0-.75-.75h-4.5a.75.75 0 0 0 0 1.5h2.553l-9.056 8.194a.75.75 0 0 0-.053 1.06Z","clipRule":"evenodd"}]]}]}]]}],". The data is stored in ",["$","a",null,{"href":"https://www.mongodb.com/atlas/database","target":"_blank","rel":"noopener","className":"inline","children":["MongoDB",["$","span",null,{"className":"inline pl-1 select-none aria-hidden","children":["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","viewBox":"0 0 20 20","fill":"currentColor","aria-hidden":"true","data-slot":"icon","aria-labelledby":"$undefined","className":"inline w-3 h-3","children":[null,["$","path",null,{"fillRule":"evenodd","d":"M4.25 5.5a.75.75 0 0 0-.75.75v8.5c0 .414.336.75.75.75h8.5a.75.75 0 0 0 .75-.75v-4a.75.75 0 0 1 1.5 0v4A2.25 2.25 0 0 1 12.75 17h-8.5A2.25 2.25 0 0 1 2 14.75v-8.5A2.25 2.25 0 0 1 4.25 4h5a.75.75 0 0 1 0 1.5h-5Z","clipRule":"evenodd"}],["$","path",null,{"fillRule":"evenodd","d":"M6.194 12.753a.75.75 0 0 0 1.06.053L16.5 4.44v2.81a.75.75 0 0 0 1.5 0v-4.5a.75.75 0 0 0-.75-.75h-4.5a.75.75 0 0 0 0 1.5h2.553l-9.056 8.194a.75.75 0 0 0-.053 1.06Z","clipRule":"evenodd"}]]}]}]]}],". To receive and process the write requests, I create an API using ",["$","a",null,{"href":"https://www.netlify.com/products/functions/","target":"_blank","rel":"noopener","className":"inline","children":["Netlify Functions",["$","span",null,{"className":"inline pl-1 select-none aria-hidden","children":["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","viewBox":"0 0 20 20","fill":"currentColor","aria-hidden":"true","data-slot":"icon","aria-labelledby":"$undefined","className":"inline w-3 h-3","children":[null,["$","path",null,{"fillRule":"evenodd","d":"M4.25 5.5a.75.75 0 0 0-.75.75v8.5c0 .414.336.75.75.75h8.5a.75.75 0 0 0 .75-.75v-4a.75.75 0 0 1 1.5 0v4A2.25 2.25 0 0 1 12.75 17h-8.5A2.25 2.25 0 0 1 2 14.75v-8.5A2.25 2.25 0 0 1 4.25 4h5a.75.75 0 0 1 0 1.5h-5Z","clipRule":"evenodd"}],["$","path",null,{"fillRule":"evenodd","d":"M6.194 12.753a.75.75 0 0 0 1.06.053L16.5 4.44v2.81a.75.75 0 0 0 1.5 0v-4.5a.75.75 0 0 0-.75-.75h-4.5a.75.75 0 0 0 0 1.5h2.553l-9.056 8.194a.75.75 0 0 0-.053 1.06Z","clipRule":"evenodd"}]]}]}]]}],". Both of these are extremely lightweight and the free tier is plenty for small sites."]}],"\n",["$","p",null,{"children":["On the frontend, a script (hosted statically) is loaded on all pages and runs on every page load. The script caches a timestamp of first load in ",["$","a",null,{"href":"https://developer.mozilla.org/en-US/docs/Web/API/Window/sessionStorage","target":"_blank","rel":"noopener","className":"inline","children":["SessionStorage",["$","span",null,{"className":"inline pl-1 select-none aria-hidden","children":["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","viewBox":"0 0 20 20","fill":"currentColor","aria-hidden":"true","data-slot":"icon","aria-labelledby":"$undefined","className":"inline w-3 h-3","children":[null,["$","path",null,{"fillRule":"evenodd","d":"M4.25 5.5a.75.75 0 0 0-.75.75v8.5c0 .414.336.75.75.75h8.5a.75.75 0 0 0 .75-.75v-4a.75.75 0 0 1 1.5 0v4A2.25 2.25 0 0 1 12.75 17h-8.5A2.25 2.25 0 0 1 2 14.75v-8.5A2.25 2.25 0 0 1 4.25 4h5a.75.75 0 0 1 0 1.5h-5Z","clipRule":"evenodd"}],["$","path",null,{"fillRule":"evenodd","d":"M6.194 12.753a.75.75 0 0 0 1.06.053L16.5 4.44v2.81a.75.75 0 0 0 1.5 0v-4.5a.75.75 0 0 0-.75-.75h-4.5a.75.75 0 0 0 0 1.5h2.553l-9.056 8.194a.75.75 0 0 0-.053 1.06Z","clipRule":"evenodd"}]]}]}]]}]," (which clears when the tab is closed)."]}],"\n",["$","p",null,{"children":"Every time the script is run, it sends a POST request to the Netlify Function with the timestamp (as a de-facto session ID) and the basic data I'm looking for (in this case, the page path and user agent)."}],"\n",["$","p",null,{"children":["On the backend, MongoDB Compass can parse and analyze the data ",["$","a",null,{"href":"https://www.mongodb.com/docs/compass/current/schema/","target":"_blank","rel":"noopener","className":"inline","children":["directly from the database",["$","span",null,{"className":"inline pl-1 select-none aria-hidden","children":["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","viewBox":"0 0 20 20","fill":"currentColor","aria-hidden":"true","data-slot":"icon","aria-labelledby":"$undefined","className":"inline w-3 h-3","children":[null,["$","path",null,{"fillRule":"evenodd","d":"M4.25 5.5a.75.75 0 0 0-.75.75v8.5c0 .414.336.75.75.75h8.5a.75.75 0 0 0 .75-.75v-4a.75.75 0 0 1 1.5 0v4A2.25 2.25 0 0 1 12.75 17h-8.5A2.25 2.25 0 0 1 2 14.75v-8.5A2.25 2.25 0 0 1 4.25 4h5a.75.75 0 0 1 0 1.5h-5Z","clipRule":"evenodd"}],["$","path",null,{"fillRule":"evenodd","d":"M6.194 12.753a.75.75 0 0 0 1.06.053L16.5 4.44v2.81a.75.75 0 0 0 1.5 0v-4.5a.75.75 0 0 0-.75-.75h-4.5a.75.75 0 0 0 0 1.5h2.553l-9.056 8.194a.75.75 0 0 0-.053 1.06Z","clipRule":"evenodd"}]]}]}]]}],". You can also always create a frontend for the data in your database. There is full data independence."]}],"\n",[["$","span",null,{"id":"1.-mongodb"}],["$","h3",null,{"children":["$","$L10",null,{"href":"#1.-mongodb","className":"after:content-['#'] after:ml-2 after:invisible hover:after:visible after:font-light after:text-base","children":"1. MongoDB"}]}]],"\n",["$","p",null,{"children":"Create a database and a collection. Then, create a user scoped to only read/write to that database/collection."}],"\n",[["$","span",null,{"id":"2.-netlify-functions"}],["$","h3",null,{"children":["$","$L10",null,{"href":"#2.-netlify-functions","className":"after:content-['#'] after:ml-2 after:invisible hover:after:visible after:font-light after:text-base","children":"2. Netlify Functions"}]}]],"\n",["$","p",null,{"children":["Using GitHub, I create a basic repo with a ",["$","code",null,{"children":"/netlify/functions/postDb.js"}]," file. ",["$","a",null,{"href":"https://docs.netlify.com/functions/build/?fn-language=js","target":"_blank","rel":"noopener","className":"inline","children":["Following the Netlify docs",["$","span",null,{"className":"inline pl-1 select-none aria-hidden","children":["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","viewBox":"0 0 20 20","fill":"currentColor","aria-hidden":"true","data-slot":"icon","aria-labelledby":"$undefined","className":"inline w-3 h-3","children":[null,["$","path",null,{"fillRule":"evenodd","d":"M4.25 5.5a.75.75 0 0 0-.75.75v8.5c0 .414.336.75.75.75h8.5a.75.75 0 0 0 .75-.75v-4a.75.75 0 0 1 1.5 0v4A2.25 2.25 0 0 1 12.75 17h-8.5A2.25 2.25 0 0 1 2 14.75v-8.5A2.25 2.25 0 0 1 4.25 4h5a.75.75 0 0 1 0 1.5h-5Z","clipRule":"evenodd"}],["$","path",null,{"fillRule":"evenodd","d":"M6.194 12.753a.75.75 0 0 0 1.06.053L16.5 4.44v2.81a.75.75 0 0 0 1.5 0v-4.5a.75.75 0 0 0-.75-.75h-4.5a.75.75 0 0 0 0 1.5h2.553l-9.056 8.194a.75.75 0 0 0-.053 1.06Z","clipRule":"evenodd"}]]}]}]]}],", I write some code to accept a JSON payload, and then send it into my database."]}],"\n",["$","p",null,{"children":["Note that if your website isn't hosted here, you will need to ",["$","a",null,{"href":"https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS/Errors/CORSMissingAllowOrigin","target":"_blank","rel":"noopener","className":"inline","children":["manually allow the domain(s)",["$","span",null,{"className":"inline pl-1 select-none aria-hidden","children":["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","viewBox":"0 0 20 20","fill":"currentColor","aria-hidden":"true","data-slot":"icon","aria-labelledby":"$undefined","className":"inline w-3 h-3","children":[null,["$","path",null,{"fillRule":"evenodd","d":"M4.25 5.5a.75.75 0 0 0-.75.75v8.5c0 .414.336.75.75.75h8.5a.75.75 0 0 0 .75-.75v-4a.75.75 0 0 1 1.5 0v4A2.25 2.25 0 0 1 12.75 17h-8.5A2.25 2.25 0 0 1 2 14.75v-8.5A2.25 2.25 0 0 1 4.25 4h5a.75.75 0 0 1 0 1.5h-5Z","clipRule":"evenodd"}],["$","path",null,{"fillRule":"evenodd","d":"M6.194 12.753a.75.75 0 0 0 1.06.053L16.5 4.44v2.81a.75.75 0 0 0 1.5 0v-4.5a.75.75 0 0 0-.75-.75h-4.5a.75.75 0 0 0 0 1.5h2.553l-9.056 8.194a.75.75 0 0 0-.053 1.06Z","clipRule":"evenodd"}]]}]}]]}]," you're using, due to CORS."]}],"\n",["$","details",null,{"children":[["$","summary",null,{"children":["$","code",null,{"className":"cursor-pointer","children":"/netlify/functions/postDb.js"}]}],["$","pre",null,{"className":"whitespace-normal","children":["$","code",null,{"className":"whitespace-pre-wrap","children":"$11"}]}]]}],"\n",[["$","span",null,{"id":"3.-frontend-script"}],["$","h3",null,{"children":["$","$L10",null,{"href":"#3.-frontend-script","className":"after:content-['#'] after:ml-2 after:invisible hover:after:visible after:font-light after:text-base","children":"3. Frontend Script"}]}]],"\n",["$","p",null,{"children":["Save this script with your website, then load it on every page. It uses ",["$","a",null,{"href":"https://developer.mozilla.org/en-US/docs/Web/API/Navigator/sendBeacon","target":"_blank","rel":"noopener","className":"inline","children":["Navigator.sendBeacon()",["$","span",null,{"className":"inline pl-1 select-none aria-hidden","children":["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","viewBox":"0 0 20 20","fill":"currentColor","aria-hidden":"true","data-slot":"icon","aria-labelledby":"$undefined","className":"inline w-3 h-3","children":[null,["$","path",null,{"fillRule":"evenodd","d":"M4.25 5.5a.75.75 0 0 0-.75.75v8.5c0 .414.336.75.75.75h8.5a.75.75 0 0 0 .75-.75v-4a.75.75 0 0 1 1.5 0v4A2.25 2.25 0 0 1 12.75 17h-8.5A2.25 2.25 0 0 1 2 14.75v-8.5A2.25 2.25 0 0 1 4.25 4h5a.75.75 0 0 1 0 1.5h-5Z","clipRule":"evenodd"}],["$","path",null,{"fillRule":"evenodd","d":"M6.194 12.753a.75.75 0 0 0 1.06.053L16.5 4.44v2.81a.75.75 0 0 0 1.5 0v-4.5a.75.75 0 0 0-.75-.75h-4.5a.75.75 0 0 0 0 1.5h2.553l-9.056 8.194a.75.75 0 0 0-.053 1.06Z","clipRule":"evenodd"}]]}]}]]}]," to send data, even after the tab closes."]}],"\n",["$","p",null,{"children":"Note that you can ignore a device by setting \"analyticsIgnore\" to \"true\" in LocalStorage. Some adblockers, such as those using EasyPrivacy, may also block Navigator.sendBeacon()."}],"\n",["$","p",null,{"children":"For frameworks (e.g. React, Vue, Svelte), you can set middleware to post a Navigator.sendBeacon() on every route change."}],"\n",["$","details",null,{"children":[["$","summary",null,{"children":["$","code",null,{"className":"cursor-pointer","children":"index.js"}]}],["$","pre",null,{"className":"whitespace-normal","children":["$","code",null,{"className":"whitespace-pre-wrap","children":"$12"}]}]]}],"\n",["$","h1",null,{"children":"Results"}],"\n",["$","p",null,{"children":"I was pleasantly surprised at how nicely this setup worked. The benefits are great:"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"MongoDB comes with powerful tools, so everything works out-of-the-box."}],"\n",["$","li",null,{"children":"You own the database, so you have full data independence, and can host it anywhere."}],"\n",["$","li",null,{"children":"You create the API, so you can easily customize what data you want to collect and store."}],"\n",["$","li",null,{"children":"Since there is no server, nothing ever goes \"out of date\", go \"down\" for maintenance, or racking up expensive server costs on traffic spikes."}],"\n"]}],"\n",["$","p",null,{"children":"This journey has walked us through NoSQL databases, protecting your MongoDB login using Node.js (Netlify Functions), and using browser APIs to persist and send data across pages."}],"\n",["$","p",null,{"children":"Some enhancements to consider are ratelimiting the Netlify Function, mandating MongoDB schema, and validating data."}],"\n",["$","h1",null,{"children":"About"}],"\n",["$","p",null,{"children":"Cats.js stands for \"Coffeebank Analytics Tracking Solution - JavaScript\"."}],"\n",["$","p",null,{"children":"Yes, I also happen to like cats."}],"\n",["$","p",null,{"children":[["$","$L10",null,{"href":"/projects/catsjs/license","children":"License: MIT - See License"}],". Hope this is helpful for your analytics needs!"]}],"\n",["$","p",null,{"className":"!text-sm","children":"Last Updated: December 27, 2022"}]]}]]}],null],"segment":"__PAGE__"},"styles":[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/bc1646f45069080b.css","precedence":"next","crossOrigin":""}]]}],"segment":"catsjs"},"styles":[]}],"segment":"projects"},"styles":[]}]}]}]]}]}],null],"segment":"(home)"},"styles":[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/db19166c1fb6b326.css","precedence":"next","crossOrigin":""}],["$","link","1",{"rel":"stylesheet","href":"/_next/static/css/6c9015bfdf3d2785.css","precedence":"next","crossOrigin":""}]]}],null]
d:null
